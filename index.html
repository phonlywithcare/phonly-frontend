<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phonly - Phone Repair at Home</title>

  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background:#f6faff;
      color:#222;
    }
    header {
      background:#1aa354;
      padding:15px;
      color:#fff;
      text-align:center;
      font-size:22px;
      font-weight:600;
      letter-spacing:1px;
    }
    section {
      padding:15px;
      margin-top:10px;
    }
    h2 {
      margin-bottom:10px;
      color:#1a7b4f;
    }
    input, select, textarea {
      width:100%;
      padding:10px;
      margin:8px 0;
      border:1px solid #ccc;
      border-radius:6px;
      font-size:15px;
    }
    button {
      width:100%;
      padding:12px;
      background:#1a7b4f;
      border:none;
      border-radius:6px;
      color:white;
      font-size:17px;
      margin-top:10px;
      cursor:pointer;
    }
    button:hover { background:#136b40; }

    .msg {
      margin-top:10px;
      font-size:15px;
      font-weight:600;
    }

    .review-box {
      background:#fff;
      padding:12px;
      margin-top:8px;
      border-radius:6px;
      box-shadow:0 1px 3px rgba(0,0,0,0.15);
    }
  </style>
</head>
<body>

<header>
  PHONLY - Doorstep Phone Repair
</header>

<section>
  <h2>Book a Repair</h2>

  <form id="bookingForm">
    <input type="text" id="name" placeholder="Your Name" required>
    <input type="text" id="phone" placeholder="Phone Number" required>
    <input type="text" id="device" placeholder="Device Model (e.g., iPhone 12)" required>

    <select id="service" required>
      <option value="">Select Service</option>
      <option value="Screen Replacement">Screen Replacement</option>
      <option value="Battery Replacement">Battery Replacement</option>
      <option value="Charging Issue">Charging Issue</option>
      <option value="Speaker Problem">Speaker Problem</option>
      <option value="Camera Issue">Camera Issue</option>
    </select>

    <textarea id="address" placeholder="Your Address" required></textarea>

    <input type="datetime-local" id="datetime">

    <button type="submit">Submit Booking</button>
    <div id="bookingMsg" class="msg"></div>
  </form>
</section>

<section>
  <h2>Customer Reviews</h2>
  <div id="reviewsList">Loading reviews...</div>
</section>

<script>
  const backend = "https://backendwithapi.onrender.com";

  // Quick selector
  function $(id){ return document.getElementById(id); }

  // ================================
  // SUBMIT BOOKING TO BACKEND
  // ================================
  $("bookingForm").addEventListener("submit", async (e)=>{
    e.preventDefault();

    const data = {
      name: $("name").value.trim(),
      phone: $("phone").value.trim(),
      device: $("device").value.trim(),
      service: $("service").value.trim(),
      address: $("address").value.trim(),
      datetime: $("datetime").value
    };

    $("bookingMsg").style.color = "#1a7b4f";
    $("bookingMsg").textContent = "Submitting...";

    try {
      const res = await fetch(`${backend}/api/bookings`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();

      if(res.ok){
        $("bookingMsg").textContent = "Booking received! Our technician will contact you shortly.";
        $("bookingForm").reset();
      } else {
        $("bookingMsg").style.color = "#aa1e1e";
        $("bookingMsg").textContent = result.message || "Server error";
      }

    } catch (err) {
      $("bookingMsg").style.color = "#aa1e1e";
      $("bookingMsg").textContent = "Network error. Try again.";
    }
  });

  // ================================
  // LOAD REVIEWS FROM BACKEND
  // ================================
  async function loadReviews(){
    try{
      const res = await fetch(`${backend}/api/reviews`);
      const reviews = await res.json();

      const container = $("reviewsList");
      container.innerHTML = "";

      if(reviews.length === 0){
        container.textContent = "No reviews yet.";
        return;
      }

      reviews.forEach(r=>{
        const div = document.createElement("div");
        div.className = "review-box";
        div.innerHTML = `
          <strong>${r.name}</strong><br>
          ‚≠ê ${r.rating}/5<br>
          <p>${r.message}</p>
        `;
        container.appendChild(div);
      });

    } catch (err){
      $("reviewsList").textContent = "Unable to load reviews.";
    }
  }

  loadReviews();
</script>

</body>
</html>
